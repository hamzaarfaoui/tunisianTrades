{% extends "base.html.twig" %}
{% block title %}{{ categorie.name }}{% endblock %}
{% block stylesheets %}{% endblock %}
{% block body %}
    <!-- NAVIGATION -->
    {% include 'includes/front/nav.html.twig' %}

    <!-- /NAVIGATION -->
    <!-- BREADCRUMB -->
    <div id="breadcrumb">
        <div class="container">
            <ul class="breadcrumb">
                <li><a href="{{ path('index_page') }}">Sindbad</a></li>
                <li class="active">{{ categorie.name }}</li>
            </ul>
        </div>
    </div>
    <!-- /BREADCRUMB -->


    <!-- section -->
    <div class="section">
        <!-- container -->
        <div class="container">
            <!-- row -->
            <div class="row">
                <!-- ASIDE -->
                <div id="aside" class="col-md-2">
                    

                    <!-- aside widget -->
                    <div class="aside">
                        <h3 class="aside-title">Prix :</h3>
                        <div id="price-slider"></div>
                    </div>
                    {% for caracteristique in categorie.caracteristiques %}
                    <!-- aside widget -->
                    <div class="aside">
                        <h5>{{ caracteristique.name }}</h5>
                        <ul>
                            {% for valeur in caracteristique.valeurs %}
                                <li>
                                    <input id="valeur{{valeur.id}}" class="valeur" type="checkbox" value="{{valeur.id}}" data-valeur="{{valeur.name}}">
                                    <label for="valeur{{valeur.id}}"> {{valeur.name}}</label>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                    <!-- /aside widget -->
                    {% endfor %}
                </div>
                <!-- /ASIDE -->

                <!-- MAIN -->
                <div id="main" class="col-md-10">
                    <!-- store top filter -->
                    <div class="store-filter clearfix">
                        <div class="pull-left">
                            <div class="sort-filter">
                                <span class="text-uppercase">Trier par :</span>
                                <select class="input filter-product" style="width: 236px;">
                                    <option>Sélectionner</option>
                                    <option value="0">De plus cher au moins cher</option>
                                    <option value="1">De moins cher au plus cher</option>
                                    <option value="2">Plus populaires</option>
                                </select>
                            </div>
                        </div>
                        <div class="pull-right">
                            <ul class="store-pages">
                                <li><span class="text-uppercase">Page:</span></li>
                                <li class="active">1</li>
                                <li><a href="#">2</a></li>
                                <li><a href="#">3</a></li>
                                <li><a href="#"><i class="fa fa-caret-right"></i></a></li>
                            </ul>
                        </div>
                    </div>
                    <!-- /store top filter -->

                    <!-- STORE -->
                    <div id="store">
                        <!-- row -->
                        <div class="row">
                            {% for product in products %}
                                {% if(product.qte>0) %}
                                <!-- Product Single -->
                                <div class="col-md-2 col-sm-6 col-xs-6">
                                    <div class="product product-single">
                                    <div class="product-thumb">
                                        <div class="product-label">
                                            {#{% set today = "now"|date("d/m/Y") %}
                                            {% set difference = date(today).diff(date(product.createdAt|date('d/m/Y'))) %}
                                            {{difference.days < 7?'<span>New </span>':''}}#}
                                            {% if(product.pricePromotion != null) %}
                                                <span class="sale">
                                                    {% set difference = product.price - product.pricePromotion %}
                                                    {% set pourcentage = (difference/product.price)*100 %}
                                                    -{{pourcentage|round}}%
                                                </span>
                                            {% endif %}
                                        </div>
                                        <a href="{{ path('product_page', {id:product.id}) }}" class="main-btn quick-view"> Détails</a>
                                        <img src="{{ asset('uploads/products/images/') }}{{ product.image }}" alt="" style="height:150px;">
                                    </div>
                                    <div class="product-body">
                                        {% if(product.pricePromotion != null) %}
                                            <h3 class="product-price">{{product.pricePromotion}} TND<del class="product-old-price">  {{product.price}} TND</del></h3>
                                        {% else %}
                                            <h3 class="product-price">{{product.price}} TND</h3>
                                        {% endif %}
                                        {#<div class="product-rating">
                                            <i class="fa fa-star"></i>
                                            <i class="fa fa-star"></i>
                                            <i class="fa fa-star"></i>
                                            <i class="fa fa-star"></i>
                                            <i class="fa fa-star-o empty"></i>
                                        </div>#}
                                        <h2 class="product-name"><a href="#">{{ product.name }}</a></h2>
                                        <div class="product-btns text-center">
                                            <button title="Ajouter à mes favoris" class="main-btn icon-btn add-to-favoris" data-id="{{product.id}}"><i class="fa fa-heart"></i></button>
                                            <!--<button class="main-btn icon-btn"><i class="fa fa-exchange"></i></button>-->
                                            {#<a href="{{ path('add_product_to_cart', {id:product.id}) }}" class="primary-btn add-to-cart"><i class="fa fa-plus"></i> <i class="fa fa-shopping-cart"></i> panier</a>#}
                                            <button title="Ajouter au panier" class="primary-btn add-to-cart" data-id="{{product.id}}"><i class="fa fa-plus"></i> <i class="fa fa-shopping-cart"></i></button>
                                        </div>
                                    </div>
                                </div>
                                </div>
                                <!-- /Product Single -->
                                {% endif %}
                            {% endfor %}
                        </div>
                        <!-- /row -->
                    </div>
                    <!-- /STORE -->

                    <!-- store bottom filter -->
                    <div class="store-filter clearfix">
                        <div class="pull-left">
                            <div class="sort-filter">
                                <span class="text-uppercase">Trier par :</span>
                                <select class="input filter-product" style="width: 236px;">
                                    <option>Sélectionner</option>
                                    <option value="0">De plus cher au moins cher</option>
                                    <option value="1">De moins cher au plus cher</option>
                                    <option value="2">Plus populaires</option>
                                </select>
                            </div>
                        </div>
                        <div class="pull-right">
                            <ul class="store-pages">
                                <li><span class="text-uppercase">Page:</span></li>
                                <li class="active">1</li>
                                <li><a href="#">2</a></li>
                                <li><a href="#">3</a></li>
                                <li><a href="#"><i class="fa fa-caret-right"></i></a></li>
                            </ul>
                        </div>
                    </div>
                    <!-- /store bottom filter -->
                </div>
                <!-- /MAIN -->
            </div>
            <!-- /row -->
        </div>
        <!-- /container -->
    </div>
                        <input type="hidden" id="categorieId" value="{{categorie.id}}">
    <!-- /section -->
{% endblock %}
{% block javascripts %}
    <script>
        $('.valeur').change(function(){
            var valeur = $('.filter-product').val();
                var categorie =$('#categorieId').val();
                var caracteristiques = [];
                if($(this).prop("checked")){
                    caracteristiques.push($(this).val());
                }else{
                    caracteristiques.pop($(this).val());
                }
                
                $.ajax({
                    url: '{{ path('tri_product') }}',
                    data: {valeur:valeur,caracteristiques:caracteristiques, categorie:categorie},
                    method: "POST",
                    error: function (data) {
                        console.log('Erreur de trier les produit');
                    },
                    success: function (data) {
                        console.log(data['nbr']);
                        {#console.log('caracteristique');
                        console.log($(this).data('valeur'));
                        console.log('tri');
                        console.log(valeur);#}
                        console.log(data['ca']);
                        $('#store').html(data['products']);
                        //setTimeout(function(){ $('#msg-alert').html('<div class="alert alert-success">'+data['message']+'</div><br><br>'); }, 3000);
                    }
                });
            });
        $('.filter-product').change(function(){
            var caracteristiques = [];
            var valeur = $(this).val();
            var categorie =$('#categorieId').val();
            $('input[type="checkbox"]').each(function() {
                if($(this).prop("checked")){
                    caracteristiques.push($(this).val());
                }
            });
            $.ajax({
                url: '{{ path('tri_product') }}',
                data: {valeur:valeur, categorie:categorie, caracteristiques:caracteristiques},
                method: "POST",
                error: function (data) {
                    console.log('Erreur de trier les produit');
                },
                success: function (data) {
                    console.log(data['ca']);
                    $('#store').html(data['products']);
                    //setTimeout(function(){ $('#msg-alert').html('<div class="alert alert-success">'+data['message']+'</div><br><br>'); }, 3000);
                }
            });
        });
    </script>
{% endblock %}
